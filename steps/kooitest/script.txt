pwsh <<'EOF'
$ErrorActionPreference = "Stop"
Import-Module VMware.VimAutomation.Core

Connect-VIServer {vmwareVcenterServer.ip} `
    -User {vmwareVcenterUser.user} `
    -Password {vmwareVcenterUser.password}

if ($? -eq $false) {
    Write-Host "Error: Not connected."
    exit 1
}

#$vm = Get-View -ViewType VirtualMachine -Filter @{'Name'="^{targetServer.fqn}$"}
$vm = Get-VM -Name "{targetServer.fqn}"

$vm
Get-VMResourceConfiguration -VM $vm

#$vm | Select-object ExtensionData.VMware.Vim.VirtualMachine

EOF